<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üìö Books Management</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #55b7fd, #f8f9fa);
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background: linear-gradient(135deg, #1d3557, #457b9d);
      color: white;
      text-align: center;
      padding: 25px 15px;
      font-size: 1.6rem;
      font-weight: bold;
      letter-spacing: 1px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .container { max-width: 1100px; margin: auto; padding: 25px; }
    .card {
      background: #ffffffa7;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover { transform: translateY(-3px); box-shadow: 0 8px 22px rgba(0,0,0,0.15); }
    h3 { margin-top: 0; color: #1d3557; }
    table {
      width: 100%; border-collapse: collapse; margin-top: 15px;
      border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    th, td { padding: 12px; text-align: center; }
    th {
      background: #457b9d; color: white; font-weight: 600;
    }
    tr:nth-child(even) { background: #f1faff; }
    tr:nth-child(odd) { background: #ffffff; }
    input {
      padding: 10px;
      margin: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
      flex: 1;
      transition: border 0.2s, box-shadow 0.2s;
    }
    input:focus {
      border-color: #457b9d;
      box-shadow: 0 0 6px rgba(69,123,157,0.4);
      outline: none;
    }
    button {
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px 0;
      transition: background 0.3s, transform 0.2s;
    }
    button:hover { transform: translateY(-2px); }
    .btn-save { background: #2ecc71; color: white; }
    .btn-save:hover { background: #27ae60; }
    .btn-update { background: #f39c12; color: white; }
    .btn-update:hover { background: #d68910; }
    .btn-delete { background: #e74c3c; color: white; }
    .btn-delete:hover { background: #c0392b; }
    .btn-borrow { background: #9b59b6; color: white; }
    .btn-borrow:hover { background: #8e44ad; }
    .btn-return { background: #16a085; color: white; }
    .btn-return:hover { background: #138d75; }
    .btn-load { background: #3498db; color: white; }
    .btn-load:hover { background: #2c80b4; }
    .form-group { display: flex; flex-wrap: wrap; gap: 10px; }
    .form-group input { flex: 1; }
    .table-dashboard { display: flex; gap: 20px; margin-top: 15px; flex-wrap: wrap; }
    .table-dashboard table { flex: 1; min-width: 350px; }
  </style>
</head>
<body>
  <header>
    üìö Books Management Dashboard
  </header>
  <div class="container">

    <!-- Books Table -->
    <div class="card">
      <h3>Books Dashboard</h3>
      <button class="btn-load" onclick="getAllBooks()">üîÑ Load Books</button>
      <div class="table-dashboard">
        <!-- Books Table -->
        <table>
          <thead>
            <tr>
              <th>ID</th><th>Title</th><th>Author</th><th>Type</th>
              <th>Book ID</th><th>Status</th><th>User_id</th><th>Borrowed By</th>
            </tr>
          </thead>
          <tbody id="booksTable"></tbody>
        </table>
      </div>
    </div>

    <!-- Add Book -->
    <div class="card">
      <h3>Add Book</h3>
      <div class="form-group">
        <input type="text" id="bookId" placeholder="Book ID">
        <input type="text" id="bookName" placeholder="Book Title">
        <input type="text" id="authorName" placeholder="Author">
        <input type="text" id="bookType" placeholder="Type">
      </div>
      <button class="btn-save" onclick="saveBook()">üíæ Save Book</button>
    </div>

    <!-- Update Book -->
    <div class="card">
      <h3>Update Book</h3>
      <div class="form-group">
        <input type="text" id="updateBookId" placeholder="Book ID">
        <input type="text" id="updateBookName" placeholder="Book Title">
        <input type="text" id="updateAuthorName" placeholder="Author">
        <input type="text" id="updateBookType" placeholder="Type">
      </div>
      <button class="btn-update" onclick="updateBook()">‚úè Update Book</button>
    </div>

    <!-- Delete Book -->
    <div class="card">
      <h3>Delete Book</h3>
      <input type="text" id="deleteBookId" placeholder="Book ID">
      <button class="btn-delete" onclick="deleteBook()">üóë Delete Book</button>
    </div>


<div class="card">
      <h3>Users Dashboard</h3>
      <button class="btn-load" onclick="getAllUsers()">üîÑ Load Users</button>
      <div class="table-dashboard">
        <!-- Users Table -->
        <table>
          <thead>
            <tr>
              <th>User_ID</th><th>User_Name</th>
            </tr>
          </thead>
          <tbody id="UsersTable"></tbody>
        </table>
      </div>
    </div>
<!-- Add User -->
    <div class="card">
      <h3>Add New User</h3>
      <input type="text" id="UserId" placeholder="User ID">
      <input type="text" id="UserName" placeholder="UserName">
      <button class="btn-save" onclick="addNewUser()">üíæ Add New User</button>
    </div>

<!-- Delete User -->
    <div class="card">
      <h3>Delete User</h3>
      <input type="text" id="userId" placeholder="Enter User Id to Delete">
      <button class="btn-delete" onclick="deleteUser()">üóë Delete User</button>
    </div>

    <!-- Borrow Book -->
    <div class="card">
      <h3>Borrow Book</h3>
      <input type="text" id="borrowUserId" placeholder="User ID">
      <input type="text" id="borrowBookId" placeholder="Book ID">
      <button class="btn-borrow" onclick="borrowBook()">üìï Borrow Book</button>
    </div>

    <!-- Return Book -->
    <div class="card">
      <h3>Return Book</h3>
      <input type="text" id="returnBookId" placeholder="Book ID">
      <button class="btn-return" onclick="returnBook()">üìó Return Book</button>
    </div>
  </div>

  <script>
    const API_BASE = "http://localhost:8080/books"; // üîπ update if needed

    // Helper to clear inputs
    function clearInputs(...ids) {
      ids.forEach(id => document.getElementById(id).value¬†=¬†"");
¬†¬†¬†¬†}

    async function getAllBooks() {
      try {
        const res = await fetch(`${API_BASE}`);
        const books = await res.json();

        const booksBody = document.getElementById("booksTable");
 
        booksBody.innerHTML = "";
        books.forEach(b => {
          booksBody.innerHTML += `
            <tr>
              <td>${b.id}</td>
              <td>${b.bookName}</td>
              <td>${b.authorName}</td>
              <td>${b.bookType}</td>
              <td>${b.id}</td>
              <td style="color:${b.borrowed_status ? "red" : "green"}; font-weight:bold;">
                ${b.borrowed_status ? "Borrowed" : "Available"}
              </td>
              <td>${b.borrowed_status ? b.borrowedBy.id : "-"}</td>
              <td>${b.borrowed_status ? b.borrowedBy.userName : "-"}</td>
            </tr>`;
        });
      } catch (err) {
        alert("Error loading books: " + err);
      }
    }

        async function getAllUsers(){
      try {
        const res = await fetch(`http://localhost:8080/users/GetAllUsers`);
        const users = await res.json();
        const userBody = document.getElementById("UsersTable");
 
        userBody.innerHTML = "";

        users.forEach(c => {
            userBody.innerHTML += `
            <tr>
              <td>${c.id}</td>
              <td>${c.userName}</td>
            </tr>`;
        });
      } catch (err) {
        alert("Error loading Users: " + err);
      }
    }

    async function saveBook() {
      const book = {
        id: document.getElementById("bookId").value,
        bookName: document.getElementById("bookName").value,
        authorName: document.getElementById("authorName").value,
        bookType: document.getElementById("bookType").value
      };
      await fetch(`${API_BASE}/SaveBook`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(book)
      });
      alert("Book saved!");
      getAllBooks();
      clearInputs("bookId","bookName","authorName","bookType");
    }

    async function updateBook() {
      const book = {
        id: document.getElementById("updateBookId").value,
        bookName: document.getElementById("updateBookName").value,
        authorName: document.getElementById("updateAuthorName").value,
        bookType: document.getElementById("updateBookType").value
      };
      await fetch(`${API_BASE}/updateBook/${book.id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(book)
      });
      alert("Book updated!");
      clearInputs("updateBookId","updateBookName","updateAuthorName","updateBookType");
      getAllBooks();
    }

    async function deleteBook() {
      const id = document.getElementById("deleteBookId").value;
      await fetch(`${API_BASE}/delete/${id}`, { method: "DELETE" });
      alert(`Book with the id: ${id} deleted!`);
      clearInputs("deleteBookId");
      getAllBooks();
    }

    async function addNewUser() {
      const newUser = {
        id: document.getElementById("UserId").value,
        userName: document.getElementById("UserName").value
      };
      await fetch(`http://localhost:8080/users/SaveUser`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(newUser)
      });
      alert("New User Added Successfully!!!");
      clearInputs("UserId","UserName");
      getAllBooks();
    }

    async function deleteUser() {
      const id = document.getElementById("userId").value;
      await fetch(`http://localhost:8080/users/${id}/delete`, { method: "DELETE" });
      alert(`User id: ${id} is deleted Successfully !!!`);
      clearInputs("userId");
      getAllBooks();
    }

    async function borrowBook() {
      const userId = document.getElementById("borrowUserId").value;
      const bookId = document.getElementById("borrowBookId").value;
      await fetch(`${API_BASE}/${bookId}/borrow/${userId}`, { method: "PATCH" });
      alert(`Book with id: ${bookId} borrowed by User with id: ${userId}!!!`);
      clearInputs("borrowUserId","borrowBookId");
      getAllBooks();
    }

    async function returnBook() {
      const bookId = document.getElementById("returnBookId").value;
      await fetch(`${API_BASE}/${bookId}/return`, { method: "PATCH" });
      alert(`Book with id: ${bookId} returned!!!`);
      clearInputs("returnBookId");
      getAllBooks();
    }
  </script>
</body>
</html>
